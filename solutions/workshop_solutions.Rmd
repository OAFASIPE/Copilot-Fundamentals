---
title: "D-Lab GitHub Copilot Workshop"
output: html_notebook
---
```{r}
# Load the tidyverse
library(tidyverse)

# Read in data
gap <- read.csv(file = "data/gapminder.csv")
head(gap)
```

### ðŸ¥Š Challenge 1:
Open the chat, highlight the code in the cell below, and ask Copilot to explain it by typing a question into the chat (e.g.., "Explain this code, please"), no need to copy the code in, highlighting is enough. 

```{r}
gap %>%
  group_by(continent, year) %>%
  summarise(mean_lifeExp = mean(lifeExp, na.rm = TRUE)) %>%
  pivot_wider(names_from = year, values_from = mean_lifeExp)
```


This is the chat response we got. note that your chat response may be different:

"This code snippet performs a series of data manipulation tasks on the gap dataset using the dplyr and tidyr packages in R. Here is a step-by-step explanation:

gap %>%: This starts a pipeline using the %>% operator, which allows for chaining multiple operations together.

group_by(continent, year) %>%: This groups the data by continent and year. Grouping is necessary for performing operations within each group separately.

summarise(mean_lifeExp = mean(lifeExp, na.rm = TRUE)) %>%: This calculates the mean life expectancy (mean_lifeExp) for each group (each combination of continent and year). The na.rm = TRUE argument ensures that any NA values in the lifeExp column are ignored in the calculation.

pivot_wider(names_from = year, values_from = mean_lifeExp): This reshapes the data from long format to wide format. Specifically:

names_from = year: The unique values in the year column will become the new column names.
values_from = mean_lifeExp: The values in the mean_lifeExp column will fill the new columns created from the year values.
Example Output
The resulting dataset will have:

One row for each continent.
One column for each year containing the mean life expectancy for that year and continent.
Example
If the original gap dataset looks like this:

continent	year	lifeExp
Africa	1952	39.1
Africa	1957	41.3
Asia	1952	45.2
Asia	1957	47.5
The transformed dataset might look like this:

continent	1952	1957
Africa	39.1	41.3
Asia	45.2	47.5
This transformation makes it easier to compare mean life expectancy across different years for each continent."

Copilot can also help us debug errors in our code. Below I have written some code to create histograms of the "lifeExp" and "gdpPercap" columns in the `gap` data frame. However, I have made three mistakes in the code. Can you find them? Highlight the code below and ask Copilot to help you debug it.

```{r}
ggplot(gap, aes(x = gdpPercap, y = lifeExp)) +
  geom_histogram(aes(fill = continet)) + 
  vline(xintercept = mean(gap$gdpPercap), color = "red") +
  labs(x = "GDP per Capita",  title = "Histogram of GDP per Capita")) +
  theme_minimal()
```
ðŸ’¡ **Tip**: Copilot may suggest changing `geom_histogram()` to `geom_point()` because it thinks we are plotting points and not a histogram since we included an x and a y. You can correct this by telling Copilot that you want a histogram of `gdpPercap`. This kind of "conversation" is an important part of working with Copilot.

If you hover your cursor over the code chunk generated by Copilot you will see in the upper-right hand corner of the cell some buttons including (1) a `Copy` button that you can click to copy the code to your clipboard and (2) an `Insert at cursor` button that you can click to insert the code at the cursor in your open file. 

Copilot corrected code:
```{r}
ggplot(gap, aes(x = gdpPercap)) +
  geom_histogram(aes(fill = continent), binwidth = 1000) +  # Corrected typo and added binwidth
  geom_vline(xintercept = mean(gap$gdpPercap), color = "red") +  # Corrected function name
  labs(x = "GDP per Capita", title = "Histogram of GDP per Capita") +  # Removed extra parenthesis
  theme_minimal() 
```

### ðŸ¥Š Challenge 2: 
Highlight this ggplot code, press `Ctrl + I`, and ask Copilot to change the background of the plot to your favorite color (e.g. "purple"), increase the text size of the x and y-axis titles to size 20, and make the title center aligned. This is super helpful for when you can't remember what the exact syntax is for a specific ggplot2 element.
```{r}
ggplot(gap, aes(x = gdpPercap)) +
  geom_histogram(binwidth = 1000, fill = "blue", color = "black") +
  labs(x = "GDP per Capita", title = "Histogram of GDP per Capita") +
  theme(plot.background = element_rect(fill = "aquamarine"),
        axis.title.x = element_text(size = 20),
        axis.title.y = element_text(size = 20),
        plot.title = element_text(hjust = 0.5))
```

### In-line suggestions
You may have noticed throughout this workshop that Copilot provides suggestions as you type in a lighter gray text. These suggestions can be helpful for completing code quickly. You can accept a suggestion by pressing `Tab`. 

Suggestions are automatically triggered by the code your write, based on context from the code you have already written. 

### ðŸ¥Š Challenge 3: 
Start typing `unique_countries <- gap` and see what suggestions Copilot gives you. Accept the suggestion that completes the code to create a vector of unique countries in the `gap` data frame.
```{r}
unique_countries <- 
  gap %>% 
  select(country) %>% 
  unique()
```

### ðŸ¥Š Challenge 4:
You can also trigger suggestions by providing comments in your code. These commments allow you to give more detailed information and context for the in-line suggestions. Start typing `# Calculate average gdpPercap and lifeExp grouped by continent for the year 2007` and see what suggestions Copilot gives you. 

ðŸ’¡ **Tip**: You may have to start writing `gap %>%` to trigger the suggestions.
```{r}
# Calculate average gdpPercap and lifeExp grouped by continent for the year 2007
gap_2007 <- gap %>%
  filter(year == 2007) %>%
  group_by(continent) %>%
  summarise(mean_gdpPercap = mean(gdpPercap), mean_lifeExp = mean(lifeExp))
```

### ðŸ¥Š Challenge 5: 

Copilot can be really useful for cleaning up your code. For example, we have code below that is a bit untidy (missing indents, no comments, long single lines of code). Highlight the code below and in the chat ask Copilot to format this code and add comments.
```{r}
gap_mean <- gap%>%filter(continent=="Asia")%>%group_by(year)%>%summarise(mean = mean(lifeExp))
ggplot(gap_mean, aes(x = year, y = mean)) +
geom_line() +
theme_classic() +
labs(x = "Year", y = "Life Expectancy", title = "Average Life Expectancy in Asia by Year")

gap_mean <- gap%>%filter(continent=="Europe")%>%group_by(year)%>%summarise(mean = mean(lifeExp))
ggplot(gap_mean, aes(x = year, y = mean)) +
geom_line() +
theme_classic() +
labs(x = "Year", y = "Life Expectancy", title = "Average Life Expectancy in Europe by Year")

gap_mean <- gap%>%filter(continent=="Oceania")%>%group_by(year)%>%summarise(mean = mean(lifeExp))
ggplot(gap_mean, aes(x = year, y = mean)) +
geom_line() +
theme_classic() +
labs(x = "Year", y = "Life Expectancy")
```

You may notice that you have to do some extra work to complete the clean-up; for example, you may want to remove unnecessary or incorrect comments or add titles that are missing.

```{r}
# Calculate the mean life expectancy for Asia by year
gap_mean <- gap %>%
  filter(continent == "Asia") %>%
  group_by(year) %>%
  summarise(mean = mean(lifeExp))

# Plot the mean life expectancy for Asia by year
ggplot(gap_mean, aes(x = year, y = mean)) +
  geom_line() +
  theme_classic() +
  labs(x = "Year", y = "Life Expectancy", title = "Average Life Expectancy in Asia by Year")

# Calculate the mean life expectancy for Europe by year
gap_mean <- gap %>%
  filter(continent == "Europe") %>%
  group_by(year) %>%
  summarise(mean = mean(lifeExp))

# Plot the mean life expectancy for Europe by year
ggplot(gap_mean, aes(x = year, y = mean)) +
  geom_line() +
  theme_classic() +
  labs(x = "Year", y = "Life Expectancy", title = "Average Life Expectancy in Europe by Year")

# Calculate the mean life expectancy for Oceania by year
gap_mean <- gap %>%
  filter(continent == "Oceania") %>%
  group_by(year) %>%
  summarise(mean = mean(lifeExp))

# Plot the mean life expectancy for Oceania by year
ggplot(gap_mean, aes(x = year, y = mean)) +
  geom_line() +
  theme_classic() +
  labs(x = "Year", y = "Life Expectancy", title = "Average Life Expectancy in Oceania by Year")
```

We can take this clean-up a step further and ask it to make a function from our repetitive code. Highlight the code above and ask Copilot to turn it into a function. 

```{r}
# Function to calculate and plot mean life expectancy by year for a given continent
plot_life_expectancy <- function(continent) {
  # Calculate the mean life expectancy for the given continent by year
  gap_mean <- gap %>%
    filter(continent == continent) %>%
    group_by(year) %>%
    summarise(mean = mean(lifeExp))

  # Plot the mean life expectancy for the given continent by year
  ggplot(gap_mean, aes(x = year, y = mean)) +
    geom_line() +
    theme_classic() +
    labs(x = "Year", y = "Life Expectancy", title = paste("Average Life Expectancy in", continent, "by Year"))
}

# Call the function for Asia
plot_life_expectancy("Asia")

# Call the function for Europe
plot_life_expectancy("Europe")

# Call the function for Oceania
plot_life_expectancy("Oceania")
```

### ðŸ¥Š Challenge 6: 

Example response from GitHub Copilot when prompted to "determine the drivers of life expectancy":

"To determine the driver of life expectancy, you can perform a regression analysis using relevant predictors such as GDP, healthcare expenditure, education, etc. Here's a step-by-step plan and the corresponding R code to perform this analysis:

Step-by-Step Plan:
Load necessary libraries: Use tidyverse for data manipulation and broom for tidying model outputs.
Load the dataset: Ensure the dataset contains life expectancy and potential predictors.
Fit a linear regression model: Use lm() to fit the model with life expectancy as the dependent variable and potential predictors as independent variables.
Summarize the model: Use summary() to get the model details.
Interpret the results: Identify significant predictors based on p-values.

R Code:
```{r}
# Load necessary libraries
library(tidyverse)
library(broom)

# Load the dataset (assuming the dataset is named 'gapminder_data')
# gapminder_data <- read.csv("path_to_your_dataset.csv")

# Fit a linear regression model
model <- lm(life_expectancy ~ gdp + healthcare_expenditure + education, data = gapminder_data)

# Summarize the model
model_summary <- summary(model)

# Print the model summary
print(model_summary)

# Tidy the model output for better readability
tidy_model <- tidy(model)

# Print the tidy model output
print(tidy_model)
```

Explanation:
Libraries: tidyverse for data manipulation and broom for tidying model outputs.
Dataset: Replace "path_to_your_dataset.csv" with the actual path to your dataset.
Model: lm() function fits a linear regression model with life expectancy as the dependent variable and GDP, healthcare expenditure, and education as predictors.
Summary: summary(model) provides detailed statistics of the model.
Tidy Output: tidy(model) provides a cleaner output of the model coefficients and statistics.
This analysis will help you identify which predictors significantly influence life expectancy."